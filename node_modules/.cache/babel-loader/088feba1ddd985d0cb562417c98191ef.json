{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport { useState, useEffect } from 'react';\nimport AuthContext from \"../context/AuthContext\";\nconst baseURL = \"http://127.0.0.1:8000/api\";\nconst useAxios = url => {\n  _s();\n  const {\n    authTokens,\n    setUser,\n    setAuthTokens\n  } = useContext(AuthContext);\n  const [data, setData] = useState([]);\n  const [isPending, setIsPending] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const abortCont = new AbortController();\n    setTimeout(() => {\n      fetch(url, {\n        signal: abortCont.signal\n      }).then(res => {\n        if (!res.ok) {\n          throw Error('Could not fetch data for that resource');\n        }\n        return res.json();\n      }).then(data => {\n        setData(data);\n        setIsPending(false);\n        setError(null);\n      }).catch(err => {\n        if (err.name === 'AbortError') {\n          console.log('Fetch aborted');\n        } else {\n          setError(err.message);\n          setIsPending(false);\n        }\n      });\n    }, 5);\n    return () => abortCont.abort();\n  }, [url]);\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authTokens === null || authTokens === void 0 ? void 0 : authTokens.access}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens.access);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    if (!isExpired) return req;\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      refresh: authTokens.refresh\n    });\n    localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n    setAuthTokens(response.data);\n    setUser(jwt_decode(response.data.access));\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n  return axiosInstance, data, isPending, error;\n};\n_s(useAxios, \"+/7+CIXFTWP268ujFJHdKfpy4+0=\");\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useContext","useState","useEffect","AuthContext","baseURL","useAxios","url","authTokens","setUser","setAuthTokens","data","setData","isPending","setIsPending","error","setError","abortCont","AbortController","setTimeout","fetch","signal","then","res","ok","Error","json","catch","err","name","console","log","message","abort","axiosInstance","create","headers","Authorization","access","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","refresh","localStorage","setItem","JSON","stringify"],"sources":["/home/meryem/repos/GatorMind/src/utils/useAxios.js"],"sourcesContent":["\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nimport { useContext } from \"react\";\nimport { useState, useEffect } from 'react';\nimport AuthContext from \"../context/AuthContext\";\n\nconst baseURL = \"http://127.0.0.1:8000/api\";\n\nconst useAxios = (url) => {\n  const { authTokens, setUser, setAuthTokens } = useContext(AuthContext);\n  const [data, setData] = useState([]);\n    const [isPending, setIsPending] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n      const abortCont = new AbortController();\n\n      setTimeout(() => {\n          fetch(url, { signal: abortCont.signal })\n          .then(res => {\n              if(!res.ok)\n              {\n                  throw Error('Could not fetch data for that resource');\n              }\n              return res.json();\n          })\n          .then((data) => {\n              setData(data);\n              setIsPending(false);\n              setError(null);\n          })\n          .catch((err) => {\n              if(err.name==='AbortError') {\n                  console.log('Fetch aborted');\n              }\n              else {\n                  setError(err.message);\n                  setIsPending(false);\n              }\n          })\n      }, 5);\n      return () => abortCont.abort();\n    },[url]);\n\n\n\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: { Authorization: `Bearer ${authTokens?.access}` }\n  });\n\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens.access);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n\n    if (!isExpired) return req;\n\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      refresh: authTokens.refresh\n    });\n\n    localStorage.setItem(\"authTokens\", JSON.stringify(response.data));\n\n    setAuthTokens(response.data);\n    setUser(jwt_decode(response.data.access));\n\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n\n  return axiosInstance, data, isPending, error;\n};\n\nexport default useAxios;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}